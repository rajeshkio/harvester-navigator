<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Harvester Navigator - Advanced Troubleshooting</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="styles/main.css">
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
</head>
<body class="antialiased">
    <div class="container mx-auto p-3 md:p-6 max-w-7xl">
        <header class="text-center mb-6">
            <div class="flex justify-between items-center mb-4">
                <div></div> <!-- Spacer -->
                <div>
                    <h1 class="text-2xl md:text-3xl font-bold text-slate-100 mb-2">Harvester Troubleshooting via UI</h1>
                    <div id="upgrade-info" class="text-sm text-slate-300 font-medium">
                        <span id="upgrade-status">Loading upgrade information...</span>
                    </div>
                </div>
                <button id="refresh-btn" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md transition-colors text-sm flex items-center gap-2">
                    <span id="refresh-icon">üîÑ</span>
                    <span>Refresh</span>
                </button>
            </div>
        </header>

        <!-- Search Bar Section -->
        <div class="card p-4 mb-6 fade-in">
            <div class="flex items-center gap-4">
                <div class="flex-1">
                    <div class="relative">
                        <input 
                            type="text" 
                            id="universal-search"
                            placeholder="üîç Search VM name, PVC name, or Volume handle..."
                            class="w-full p-3 bg-slate-700/50 border border-slate-600 text-white placeholder-slate-400 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all"
                        />
                        <div id="search-results" class="absolute top-full left-0 right-0 z-10 mt-1 bg-slate-800 border border-slate-600 rounded-lg shadow-lg hidden max-h-60 overflow-y-auto"></div>
                    </div>
                </div>
                <button id="clear-search" class="bg-slate-600 hover:bg-slate-500 text-white px-4 py-3 rounded-lg transition-colors text-sm hidden">
                    Clear
                </button>
            </div>
            <div id="search-status" class="mt-2 text-sm text-slate-400 hidden"></div>
        </div>

        <main id="dashboard" class="space-y-6">
            <div id="issues-overview" class="card p-4 fade-in hidden">
                <div class="flex justify-between items-center mb-4">
                    <h2 class="text-xl font-bold text-slate-200 flex items-center gap-2">
                        üö® Detected Issues
                        <span id="issue-count" class="bg-red-600 text-white text-xs font-bold px-2 py-0.5 rounded-full">0</span>
                    </h2>
                    <button id="view-all-issues-btn" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors text-sm">
                        View All Issues
                    </button>
                </div>
                <div id="critical-issues-preview" class="space-y-2"></div>
            </div>

            <div id="node-dashboard-container" class="card p-4 fade-in">
                <h2 class="text-xl font-bold mb-3 text-slate-200">Node Dashboard</h2>
                <div id="node-dashboard" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"></div>
            </div>

            <div id="vm-list-container" class="card p-4 fade-in">
                <h2 class="text-xl font-bold mb-3 text-slate-200">Virtual Machines</h2>
                <div id="vm-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4"></div>
            </div>
        </main>

        <div id="detail-view-container" class="hidden space-y-4">
            <button id="back-button" class="mb-4 bg-blue-600 text-white font-medium py-2 px-4 rounded-md hover:bg-blue-700 transition-colors text-sm">
                ‚Üê Back to Dashboard
            </button>
            <div id="detail-view" class="space-y-4"></div>
        </div>

        <div id="all-issues-container" class="card p-4 fade-in hidden">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-slate-200">All Detected Issues</h2>
                <button id="back-from-all-issues" class="bg-slate-600 text-white px-4 py-2 rounded-md hover:bg-slate-700 transition-colors text-sm">
                    Back to Dashboard
                </button>
            </div>
            <div id="issue-filter-bar" class="bg-slate-900/50 p-3 rounded-md mb-4 flex gap-4 items-center">
                <div class="flex-grow">
                    <input type="search" id="issue-search-input" placeholder="Search by name or message..." class="w-full bg-slate-800 text-slate-200 px-3 py-1.5 rounded-md text-sm focus:ring-2 focus:ring-blue-500 focus:outline-none">
                </div>
                <div>
                    <select id="issue-severity-filter" class="bg-slate-800 text-slate-200 px-3 py-1.5 rounded-md text-sm focus:ring-2 focus:ring-blue-500 focus:outline-none">
                        <option value="all">All Severities</option>
                        <option value="critical">Critical</option>
                        <option value="high">High</option>
                        <option value="medium">Medium</option>
                        <option value="low">Low</option>
                    </select>
                </div>
                <div>
                    <select id="issue-sort-filter" class="bg-slate-800 text-slate-200 px-3 py-1.5 rounded-md text-sm focus:ring-2 focus:ring-blue-500 focus:outline-none">
                        <option value="time-desc">Newest First</option>
                        <option value="time-asc">Oldest First</option>
                        <option value="severity-desc">Severity (High to Low)</option>
                    </select>
                </div>
            </div>
            <div id="all-issues-list" class="space-y-3"></div>
        </div>

        <div id="issue-detail-container" class="hidden">
            <button id="back-from-issue" class="mb-4 bg-blue-600 text-white font-medium py-2 px-4 rounded-md hover:bg-blue-700 transition-colors text-sm">
                ‚Üê Back to Issues
            </button>
            <div id="issue-detail-view" class="space-y-4"></div>
        </div>
    </div>

    <!-- Load modules in dependency order -->
    <script src="js/config.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/state.js"></script>
    <script src="js/websocket.js"></script>
    <script src="js/issue-detector.js"></script>
    <script src="js/renderers/node-renderer.js"></script>
    <script src="js/renderers/vm-renderer.js"></script>
    <script src="js/renderers/issue-renderer.js"></script>
    <script src="js/renderers/detail-renderer.js?v=node-functions-added"></script>
    <script src="js/search.js"></script>
    <script src="js/view-manager.js"></script>
    <script src="js/app.js"></script>
</body>
</html>